<div class="my-3">
    <div class="text-center mb-3">
        <span class="fw-bold">PRODUCT REPORT</span>
    </div>
    <div class="d-flex flex-column flex-md-row justify-content-start align-items-center mb-3">
        <div class="d-flex flex-column mx-4">
            <span class="p-2">
                <i class="fas fa-search"></i>
                Search:
            </span>
            <input [(ngModel)]="query" id="buscarProducto" name="q" type="text" class="form-control form-control-sm"
                (keyup.enter)="getReport()">
        </div>
        <div class="d-flex flex-column mx-4">
            <span class="p-2">
                <i class="fas fa-filter"></i>
                Filter by status:
            </span>
            <select class="form-select form-select-sm" [(ngModel)]="statusFilter" (change)="getReport()">
                <option value="null">Ninguno</option>
                <option value="1">Created</option>
                <option value="2">Published</option>
                <option value="3">Disabled</option>
            </select>
        </div>
        <div class="d-flex flex-column mx-4">
            <span class="p-2">
                <i class="fas fa-calendar-alt"></i>
                Filter by date:
            </span>
            <input type="text" ngxDaterangepickerMd [(ngModel)]="dateFilter" class="form-control form-control-sm"
                (change)="getReport($event)" [alwaysShowCalendars]="true" [showDropdowns]="true"
                [locale]="{applyLabel: 'ok', format: 'DD-MM-YYYY'}" [maxDate]="maxDate" />
        </div>
        <div class="d-flex flex-column mx-4">
            <span class="d-none d-md-block p-2 invisible">.</span>
            <a class="mt-3 mt-md-0 btn btn-sm btn-info" (click)="getReport()">
                <i class="fas fa-sync-alt"></i>
                Refresh
            </a>
        </div>
    </div>
    <div class="d-flex">
        <div class="d-flex flex-column mx-4">
            <a class="btn btn-sm btn-success cp" [routerLink]="[appRoutes.PRODUCT_CREATE_COMPONENT_ROUTE_NAME]">
                <i class="fa fa-plus"></i>
                Create new product
            </a>
        </div>
    </div>
</div>

<ng-container *ngIf="!loading">
    <div class="mx-1">
        <p-table [value]="productsList!" styleClass="fs-12px p-1 p-datatable-sm" selectionMode="single" [(selection)]="selectedProduct"
            dataKey="id" [scrollable]="false" tableStyleClass="w-2000px">
            <ng-template pTemplate="colgroup">
                <colgroup>
                    <col style="width:160px">  <!-- id -->
                    <col style="width:90px">   <!-- status -->
                    <col style="width:100px">  <!-- sku -->
                    <col style="width:150px">  <!-- name -->
                    <col style="width:70px">   <!-- stock -->
                    <col style="width:70px">   <!-- price -->
                    <col style="width:160px">  <!-- discount-->
                    <col style="width:90px">   <!-- brand -->
                    <col style="width:90px">   <!-- categories -->
                    <col style="width:110px">  <!-- specifications -->
                    <col style="width:80px">   <!-- media content-->
                    <col style="width:80px">   <!-- rating -->
                    <col style="width:80px">   <!-- keywords -->
                    <col style="width:100px">
                    <col style="width:100px">
                </colgroup>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th class="fw-bold">ID</th>
                    <th class="fw-bold">STATUS</th>
                    <th class="fw-bold">SKU</th>
                    <th class="fw-bold">NAME</th>
                    <th class="fw-bold">STOCK</th>
                    <th class="fw-bold">PRICE</th>
                    <th class="fw-bold">DISCOUNT</th>
                    <th class="fw-bold">BRAND</th>
                    <th class="fw-bold">CATEGORIES</th>
                    <th class="fw-bold">SPECIFICATIONS</th>
                    <th class="fw-bold">IMAGES</th>
                    <th class="fw-bold">RATING</th>
                    <th class="fw-bold">KEYWORDS</th>
                    <th class="fw-bold">CREATED AT</th>
                    <th class="fw-bold">ACTION</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product>
                <tr [pSelectableRow]="product">
                    <td>{{product.id}}</td>
                    <td>
                        <container-element [ngSwitch]="product.status">
                            <div *ngSwitchCase="1">
                                <a class="btn btn-sm btn-light border fs-12px">CREATED</a>
                            </div>
                            <div *ngSwitchCase="2">
                                <a class="btn btn-sm btn-primary fs-12px">PUBLISHED</a>
                            </div>
                            <div *ngSwitchCase="3">
                                <a class="btn btn-sm btn-warning fs-12px">DISABLED</a>
                            </div>
                        </container-element>
                    </td>
                    <td>{{product.sku}}</td>
                    <td>{{product.name}}</td>
                    <td>
                        <span class="fs-16px">
                            {{product.stock}}
                        </span>
                    </td>
                    <td>
                        <span class="fs-16px">
                            S/{{product.price}}
                        </span>
                    </td>
                    <td>
                        <ng-container *ngIf="product.discount; else empty">
                            <div class="text-center fs-16px">{{product.discount.percentage}}%</div>
                            <div class="text-center">{{product.discount.startDate | date: 'yyyy-MM-dd HH:mm'}}</div>
                           <div class="text-center">{{product.discount.endDate | date: 'yyyy-MM-dd HH:mm'}}</div>
                        </ng-container>
                    </td>

                    <td>{{product.brand}}</td>
                    <ng-container *ngIf="product.categories.length!==0; else empty">
                        <td>
                            <span *ngFor="let category of product.categories">{{category}}</span>
                        </td>
                    </ng-container>
                    <ng-container *ngIf="product.specifications.length!==0; else empty">
                        <td>
                            <div *ngFor="let specification of product.specifications">{{specification}}</div>
                        </td>
                    </ng-container>
                    <td>
                        <a class="btn btn-sm bg-indigo-with-hover text-white cp"
                            (click)="switchDisplayProductImages(product.mediaUrls)">
                            <i class="far fa-images"></i>
                        </a>
                    </td>
                    <td>{{product.rating}}</td>
                    <td>{{product.keywords}}</td>
                    <td>{{product.createdAt | date:'dd-MM-YY hh:mm:ss a'}}</td><!--  -->
                    <td>
                        <a class="btn btn-sm btn-warning cp me-3" (click)="updateProduct(product)">
                            <i class="far fa-edit"></i>
                            <span class="fs-10px">UPDATE</span>
                        </a>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <!-- Pagination -->
    <div class="row mx-1 mt-2 justify-content-center">
        <div class="col-auto">
            <ul class="pagination pagination-sm">
                <li class="page-item">
                    <ng-container *ngIf="currentPage-1 > 0; else previusPageDisabled">
                        <span class="page-link cp" (click)="updatePage(currentPage-1)"><i class="fas fa-angle-left"></i></span>
                    </ng-container>
                    <ng-template #previusPageDisabled>
                        <span class="page-link cp"><i class="fas fa-angle-left"></i></span>
                    </ng-template>
                </li>
                <li *ngFor="let i of uiPaginationArray" class="page-item" [ngClass]="{'active': i==currentPage}">
                    <ng-container *ngIf="i != '...'; else noActivePage">
                        <span (click)="updatePage(i)" class="page-link cp">{{ i }}</span>
                    </ng-container>
                    <ng-container *ngIf="i==currentPage">

                    </ng-container>
                    <ng-template #noActivePage>
                        <span class="page-link">...</span>
                    </ng-template>
                </li>
                <li class="page-item">
                    <ng-container *ngIf="currentPage < totalPages; else nextPageDisabled">
                        <span class="page-link cp" (click)="updatePage(currentPage+1)"><i
                                class="fas fa-angle-right"></i></span>
                    </ng-container>
                    <ng-template #nextPageDisabled>
                        <span class="page-link cp"><i class="fas fa-angle-right"></i></span>
                    </ng-template>
                </li>
            </ul>
        </div>
    </div>
</ng-container>


<p-dialog header="PRODUCT IMAGES" [(visible)]="displayImagesPopUp" [baseZIndex]="1" [modal]="true"
           [draggable]="false" [resizable]="false" [closable]="true" [dismissableMask]="true">
  <div class="container-fluid">
    <table class="table table-hover">
      <tbody>
      <ng-container *ngIf="selectedProductImages">
        <ng-container *ngFor="let image of selectedProductImages">
          <tr>
            <td>
              <img [src]="image" class="w-50px cp">
            </td>
            <td>
              <a href="{{image}}" target="_blank">{{ image }}</a>
            </td>
          </tr>
        </ng-container>
      </ng-container>
      </tbody>
    </table>
  </div>
</p-dialog>


<ng-template #empty>
    <td></td>
</ng-template>
